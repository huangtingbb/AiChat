# èŠå¤©æœºå™¨äººé¡¹ç›®

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªåŸºäºŽGoåŽç«¯å’ŒVue3å‰ç«¯çš„èŠå¤©æœºå™¨äººåº”ç”¨ï¼Œæ”¯æŒå¤šç§AIæ¨¡åž‹å¯¹è¯ã€‚

## æŠ€æœ¯æ ˆ

### åŽç«¯
- **è¯­è¨€**: Go 1.24
- **æ¡†æž¶**: Gin
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis
- **æ—¥å¿—**: Logrus
- **è®¤è¯**: JWT
- **æ–‡æ¡£**: Swagger

### å‰ç«¯
- **æ¡†æž¶**: Vue3
- **æž„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶**: å¾…é€‰æ‹©

## é¡¹ç›®ç»“æž„

```
chatbot-app/
â”œâ”€â”€ backend/                 # åŽç«¯ä»£ç 
â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ controller/         # æŽ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“è¿žæŽ¥
â”‚   â”œâ”€â”€ docs/               # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ migrations/         # è¿ç§»æ–‡ä»¶
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡åž‹
â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ utils/              # å·¥å…·åŒ…
â”‚   â”‚   â”œâ”€â”€ ai_client.go    # AIå®¢æˆ·ç«¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ ai_factory.go   # AIå®¢æˆ·ç«¯å·¥åŽ‚
â”‚   â”‚   â”œâ”€â”€ jwt.go          # JWTå·¥å…·
â”‚   â”‚   â”œâ”€â”€ logger.go       # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ password.go     # å¯†ç å·¥å…·
â”‚   â”‚   â””â”€â”€ response.go     # å“åº”å·¥å…·
â”‚   â”œâ”€â”€ .env                # çŽ¯å¢ƒå˜é‡
â”‚   â””â”€â”€ main.go             # ç¨‹åºå…¥å£
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç 
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜Ž
```

## æœ€æ–°æ›´æ–° (2025-01-27)

### ðŸ¤– Cozeæ™ºèƒ½ä½“é›†æˆå®Œæˆ
1. **Cozeå¹³å°æ”¯æŒ**
   - å®Œæ•´é›†æˆCozeæ™ºèƒ½ä½“å¹³å°
   - æ”¯æŒCoze Botå¯¹è¯æ¨¡å¼å’ŒWorkflowå·¥ä½œæµæ¨¡å¼
   - å®žçŽ°JWT OAuthè®¤è¯å’ŒTokenç¼“å­˜æœºåˆ¶
   - æ”¯æŒæµå¼å’Œéžæµå¼ä¸¤ç§å“åº”æ¨¡å¼

2. **é…ç½®ç®¡ç†**
   - æ·»åŠ `CozeConfig`é…ç½®ç»“æž„ä½“
   - æ”¯æŒYAMLé…ç½®æ–‡ä»¶å’ŒçŽ¯å¢ƒå˜é‡ä¸¤ç§é…ç½®æ–¹å¼
   - è‡ªåŠ¨ä»ŽRedisç¼“å­˜Tokenï¼Œæé«˜è°ƒç”¨æ•ˆçŽ‡
   - é…ç½®æ–‡ä»¶ï¼š`config/coze_config.yaml`

3. **æœåŠ¡æž¶æž„**
   - åˆ›å»ºä¸“ç”¨çš„`CozeService`å¤„ç†æ™ºèƒ½ä½“è°ƒç”¨
   - é›†æˆåˆ°AIå·¥åŽ‚æ¨¡å¼ï¼Œæ”¯æŒå¤šAIæä¾›å•†ç»Ÿä¸€ç®¡ç†
   - å®žçŽ°`CozeClientAdapter`é€‚é…å™¨ï¼Œç¬¦åˆçŽ°æœ‰AIæŽ¥å£æ ‡å‡†
   - æ”¯æŒå¯¹è¯åŽ†å²å’Œä¸Šä¸‹æ–‡ç®¡ç†

4. **æ•°æ®åº“æ”¯æŒ**
   - æ·»åŠ Cozeæ¨¡åž‹åˆ°æ•°æ®åº“è¿ç§»æ–‡ä»¶
   - æ”¯æŒCoze Botå’ŒCoze Workflowä¸¤ç§æ¨¡åž‹ç±»åž‹
   - å®Œå–„çš„ä½¿ç”¨è®°å½•å’Œæ€§èƒ½ç›‘æŽ§

5. **æµå¼å“åº”**
   - æ”¯æŒCozeæ™ºèƒ½ä½“çš„æµå¼å¯¹è¯
   - æ”¯æŒCozeå·¥ä½œæµçš„æµå¼æ‰§è¡Œ
   - å®žæ—¶äº‹ä»¶å¤„ç†å’Œé”™è¯¯ç®¡ç†
   - ä¸ŽçŽ°æœ‰SSEæž¶æž„å®Œç¾Žé›†æˆ

### ðŸ“‹ Cozeé›†æˆå®Œæˆæ¸…å•
- âœ… **é…ç½®ç®¡ç†**ï¼šæ”¯æŒYAMLå’ŒçŽ¯å¢ƒå˜é‡ä¸¤ç§é…ç½®æ–¹å¼
- âœ… **JWTè®¤è¯**ï¼šè‡ªåŠ¨èŽ·å–å’Œç¼“å­˜Access Token
- âœ… **Redisç¼“å­˜**ï¼šTokenç¼“å­˜ä¼˜åŒ–ï¼Œå‡å°‘APIè°ƒç”¨
- âœ… **æœåŠ¡æž¶æž„**ï¼šä¸“ç”¨CozeServiceå’Œé€‚é…å™¨æ¨¡å¼
- âœ… **æ•°æ®åº“é›†æˆ**ï¼šè‡ªåŠ¨æ·»åŠ Cozeæ¨¡åž‹åˆ°æ•°æ®åº“
- âœ… **æµå¼å“åº”**ï¼šå®Œæ•´çš„SSEæµå¼å¯¹è¯æ”¯æŒ
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **ä½¿ç”¨ç»Ÿè®¡**ï¼šTokenæ¶ˆè€—å’Œæ€§èƒ½ç›‘æŽ§
- âœ… **æµ‹è¯•å·¥å…·**ï¼šæä¾›å®Œæ•´çš„æµ‹è¯•å’Œç¤ºä¾‹ä»£ç 
- âœ… **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„è®¾ç½®æŒ‡å—å’ŒAPIæ–‡æ¡£

### ðŸŽ¯ è‡ªå®šä¹‰ä¸­æ–‡éªŒè¯å‚æ•°åŠŸèƒ½å®Œæˆ
1. **ä¸­æ–‡éªŒè¯å™¨å®žçŽ°**
   - åˆ›å»ºå®Œæ•´çš„è‡ªå®šä¹‰ä¸­æ–‡éªŒè¯ç³»ç»Ÿ `utils/validator.go`
   - æ”¯æŒä¸­æ–‡é”™è¯¯æ¶ˆæ¯å’Œå­—æ®µåç§°æ˜ å°„
   - è‡ªåŠ¨å°†è‹±æ–‡å­—æ®µåè½¬æ¢ä¸ºä¸­æ–‡æç¤º
   - é›†æˆåˆ°Ginæ¡†æž¶çš„éªŒè¯å™¨ç³»ç»Ÿä¸­

2. **è‡ªå®šä¹‰éªŒè¯è§„åˆ™**
   - `mobile`: ä¸­å›½æ‰‹æœºå·éªŒè¯ï¼ˆ11ä½æ•°å­—ï¼Œä»¥1å¼€å¤´ï¼‰
   - `strong_password`: å¼ºå¯†ç éªŒè¯ï¼ˆå¿…é¡»åŒ…å«æ•°å­—å’Œå­—æ¯ï¼‰
   - `username_format`: ç”¨æˆ·åæ ¼å¼éªŒè¯ï¼ˆåªèƒ½åŒ…å«ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼‰
   - æ”¯æŒåŠ¨æ€æ³¨å†Œæ–°çš„éªŒè¯è§„åˆ™

3. **ä¸­æ–‡é”™è¯¯æ¶ˆæ¯ç³»ç»Ÿ**
   - å†…ç½®è§„åˆ™ä¸­æ–‡åŒ–ï¼š`required`â†’"ä¸èƒ½ä¸ºç©º"ï¼Œ`min`â†’"é•¿åº¦ä¸èƒ½å°‘äºŽXä¸ªå­—ç¬¦"ç­‰
   - å­—æ®µåç§°æ˜ å°„ï¼š`username`â†’"ç”¨æˆ·å"ï¼Œ`password`â†’"å¯†ç "ï¼Œ`email`â†’"é‚®ç®±"ç­‰
   - å‹å¥½çš„é”™è¯¯æç¤ºæ ¼å¼ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

4. **æŽ§åˆ¶å™¨é›†æˆ**
   - ä¿®æ”¹ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æŽ¥å£ä½¿ç”¨ä¸­æ–‡éªŒè¯
   - ä¿®æ”¹èŠå¤©ç›¸å…³æŽ¥å£ä½¿ç”¨ä¸­æ–‡éªŒè¯
   - ç»Ÿä¸€çš„éªŒè¯é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
   - æ”¯æŒèŽ·å–å•ä¸ªé”™è¯¯æˆ–æ‰€æœ‰é”™è¯¯æ¶ˆæ¯

5. **éªŒè¯å·¥å…·å‡½æ•°**
   - `GetValidationError()`: èŽ·å–ç¬¬ä¸€ä¸ªéªŒè¯é”™è¯¯
   - `GetAllValidationErrors()`: èŽ·å–æ‰€æœ‰éªŒè¯é”™è¯¯ï¼Œç”¨åˆ†å·åˆ†éš”
   - `ValidateStruct()`: èŽ·å–è¯¦ç»†çš„éªŒè¯é”™è¯¯åˆ—è¡¨
   - `RegisterCustomValidation()`: åŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰éªŒè¯è§„åˆ™

### ðŸ“š å®Œæ•´éªŒè¯æ–‡æ¡£
- åˆ›å»ºè¯¦ç»†çš„ä½¿ç”¨æŒ‡å— `docs/VALIDATION.md`
- åŒ…å«ä½¿ç”¨æ–¹æ³•ã€ç¤ºä¾‹ä»£ç å’Œæœ€ä½³å®žè·µ
- æ”¯æŒè‡ªå®šä¹‰éªŒè¯è§„åˆ™çš„æ‰©å±•è¯´æ˜Ž

### ðŸ› ä¿®å¤é—ªçƒé—®é¢˜å’Œä¼˜åŒ–è¾“å‡ºé€Ÿåº¦
1. **ä¼˜åŒ–æ¶ˆæ¯æ¸²æŸ“**
   - ä¿®å¤ç”Ÿæˆç¬¬äºŒä¸ªå›žå¤æ—¶ç¬¬ä¸€ä¸ªå›žå¤é—ªçƒçš„é—®é¢˜
   - ä¼˜åŒ–æ¶ˆæ¯æ¸²æŸ“keyç”Ÿæˆç­–ç•¥ï¼Œåªæœ‰å†…å®¹çœŸæ­£å˜åŒ–æ—¶æ‰æ›´æ–°
   - ç§»é™¤ä¸å¿…è¦çš„`messageUpdateCount`å…¨å±€æ›´æ–°ä¾èµ–
   - æ”¹è¿›æµå¼æ¶ˆæ¯ç›‘å¬é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ CSS `contain: layout style` æé«˜æ¸²æŸ“æ€§èƒ½
   - ä¼˜åŒ–`will-change`å±žæ€§ä½¿ç”¨ï¼Œå‡å°‘é‡æŽ’é‡ç»˜
   - å®žçŽ°æ›´ç²¾ç¡®çš„æµå¼æ¶ˆæ¯çŠ¶æ€è·Ÿè¸ª
   - ä¼˜åŒ–æ»šåŠ¨è¡Œä¸ºï¼Œå‡å°‘é¢‘ç¹æ»šåŠ¨è§¦å‘

3. **æµå¼è¾“å‡ºé€Ÿåº¦æŽ§åˆ¶**
   - åœ¨åŽç«¯æ·»åŠ æ™ºèƒ½å»¶è¿ŸæŽ§åˆ¶ï¼Œæ ¹æ®å†…å®¹é•¿åº¦åŠ¨æ€è°ƒæ•´è¾“å‡ºé€Ÿåº¦
   - å»¶è¿ŸèŒƒå›´ï¼š50ms-300msï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿèˆ’é€‚åœ°é˜…è¯»å†…å®¹
   - é¿å…è¿‡å¿«çš„æ–‡æœ¬è¾“å‡ºå½±å“ç”¨æˆ·ä½“éªŒ

4. **æ™ºèƒ½æ»šåŠ¨ä¼˜åŒ–**
   - æ£€æµ‹ç”¨æˆ·æ‰‹åŠ¨æ»šåŠ¨è¡Œä¸ºï¼Œé¿å…è‡ªåŠ¨æ»šåŠ¨å¹²æ‰°ç”¨æˆ·é˜…è¯»
   - åªæœ‰åœ¨æŽ¥è¿‘åº•éƒ¨æ—¶æ‰è¿›è¡Œè‡ªåŠ¨æ»šåŠ¨
   - æ·»åŠ "æ»šåŠ¨åˆ°åº•éƒ¨"æŒ‰é’®ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿå›žåˆ°æœ€æ–°æ¶ˆæ¯
   - å‘é€æ¶ˆæ¯å’Œåˆ‡æ¢èŠå¤©æ—¶å¼ºåˆ¶æ»šåŠ¨åˆ°åº•éƒ¨
   - ä¿®å¤æ»šåŠ¨é€»è¾‘å†²çªï¼Œé˜²æ­¢ç¨‹åºæ»šåŠ¨è¢«è¯¯åˆ¤ä¸ºç”¨æˆ·æ»šåŠ¨
   - æ·»åŠ è°ƒè¯•æ—¥å¿—å’Œç®€åŒ–æ»šåŠ¨å‡½æ•°ï¼Œç¡®ä¿æ»šåŠ¨åŠŸèƒ½æ­£å¸¸å·¥ä½œ
   - ä¼˜åŒ–æµå¼è¾“å‡ºæ—¶çš„å®žæ—¶æ»šåŠ¨ï¼Œç¡®ä¿å†…å®¹è¾“å‡ºè¿‡ç¨‹ä¸­å±å¹•è·Ÿéšæ»šåŠ¨
   - é™ä½Žæµå¼è¾“å‡ºæ—¶ç”¨æˆ·æ»šåŠ¨æ£€æµ‹çš„æ•æ„Ÿåº¦ï¼Œé¿å…è¯¯åˆ¤æ–­è‡ªåŠ¨æ»šåŠ¨

### ðŸš€ æµå¼AIå›žå¤åŠŸèƒ½å®Œæˆ
1. **æµå¼å“åº”å®žçŽ°**
   - æ‰©å±•`AIClient`æŽ¥å£ï¼Œæ·»åŠ `GenerateStreamResponse`æ–¹æ³•
   - å®žçŽ°æ™ºè°±AIçš„Server-Sent Events (SSE) æµå¼å“åº”
   - æ”¯æŒå®žæ—¶æŽ¥æ”¶å’Œå¤„ç†AIç”Ÿæˆçš„æ–‡æœ¬å—
   - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè¿žæŽ¥ç®¡ç†

2. **æµå¼å›žè°ƒæœºåˆ¶**
   - ç»Ÿä¸€çš„æµå¼å›žè°ƒå‡½æ•°ç­¾åï¼š`func(chunk string, isEnd bool, err error) bool`
   - æ”¯æŒå®žæ—¶æ–‡æœ¬è¾“å‡ºå’Œå®Œæ•´å“åº”æ”¶é›†
   - å®¢æˆ·ç«¯å¯é€šè¿‡è¿”å›ž`false`ä¸­æ–­æµå¼ä¼ è¾“
   - è‡ªåŠ¨è®°å½•ä½¿ç”¨æƒ…å†µå’ŒTokenæ¶ˆè€—

3. **æ™ºè°±AI GLM-Z1æ¨¡åž‹æ”¯æŒ**
   - æ”¯æŒæ™ºè°±AIæœ€æ–°çš„æŽ¨ç†æ¨¡åž‹
   - å®Œæ•´çš„è¯·æ±‚å¤´è®¾ç½®ï¼ˆAccept: text/event-streamï¼‰
   - æ­£ç¡®è§£æžSSEæ ¼å¼çš„å“åº”æ•°æ®
   - JWT Tokenè‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†

### AIæœåŠ¡æž¶æž„é‡æž„
1. **å·¥å…·ä»£ç é‡æž„**
   - å°†AIå®¢æˆ·ç«¯ç›¸å…³ä»£ç ä»Ž`services/ai_clients`ç§»åŠ¨åˆ°`utils`ç›®å½•
   - åˆ›å»ºç»Ÿä¸€çš„AIå®¢æˆ·ç«¯æŽ¥å£`AIClient`
   - å®žçŽ°æ™ºè°±AIå®¢æˆ·ç«¯`ZhipuClient`
   - æ·»åŠ AIå®¢æˆ·ç«¯å·¥åŽ‚`AIClientFactory`

2. **æœåŠ¡å±‚ä¼˜åŒ–**
   - é‡å†™`AiService`ï¼Œä½¿ç”¨utilsä¸­çš„å·¥å…·
   - ç®€åŒ–AIæ¨¡åž‹æœåŠ¡`AIModelService`
   - ç§»é™¤é‡å¤çš„ä»£ç å’Œæ–¹æ³•
   - ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼è½¬æ¢

3. **æŽ§åˆ¶å™¨å®Œå–„**
   - æ·»åŠ `SelectModel`æ–¹æ³•ç”¨äºŽé€‰æ‹©AIæ¨¡åž‹
   - æ·»åŠ `GetModelUsageHandler`æ–¹æ³•èŽ·å–ä½¿ç”¨è®°å½•
   - å®Œå–„APIæ–‡æ¡£æ³¨é‡Š

4. **ä»£ç ç»“æž„ä¼˜åŒ–**
   - åˆ é™¤æ—§çš„`ai_clients`ç›®å½•
   - ç»Ÿä¸€ä½¿ç”¨utilsä¸­çš„å·¥å…·å‡½æ•°
   - æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### æŠ€æœ¯æ”¹è¿›
- **æ¨¡å—åŒ–è®¾è®¡**: å°†AIç›¸å…³å·¥å…·é›†ä¸­åˆ°utilsç›®å½•ï¼Œä¾¿äºŽç»´æŠ¤å’Œæ‰©å±•
- **æŽ¥å£æŠ½è±¡**: ä½¿ç”¨æŽ¥å£è®¾è®¡ï¼Œæ”¯æŒå¤šç§AIæä¾›å•†
- **å·¥åŽ‚æ¨¡å¼**: ä½¿ç”¨å·¥åŽ‚æ¨¡å¼åˆ›å»ºAIå®¢æˆ·ç«¯ï¼Œä¾¿äºŽæ‰©å±•æ–°çš„AIæœåŠ¡
- **é…ç½®ç®¡ç†**: æ”¯æŒä»ŽçŽ¯å¢ƒå˜é‡è¯»å–APIå¯†é’¥å’ŒåŸºç¡€URL
- **æµå¼å¤„ç†**: æ”¯æŒServer-Sent Eventsæµå¼å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### çŽ¯å¢ƒå˜é‡é…ç½®
```bash
# æ™ºè°±AIé…ç½®
ZHIPU_API_KEY=your_api_key_here
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/paas/v4
```

## çŽ¯å¢ƒå˜é‡è¯¦ç»†é…ç½®

### é…ç½®æ–‡ä»¶ä½ç½®
åœ¨`backend`ç›®å½•ä¸‹åˆ›å»º`.env`æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
SERVER_PORT=8080
SERVER_MODE=debug

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password_here
DB_NAME=chatbot

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_DB=0

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE=logs/app.log
LOG_MAX_SIZE=100
LOG_MAX_AGE=30
LOG_COMPRESS=true

# AIé…ç½®
# æ™ºè°±AIé…ç½®ï¼ˆå¿…å¡«ï¼‰
ZHIPU_API_KEY=your_zhipu_api_key_here
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/paas/v4

# OpenAIé…ç½®ï¼ˆé¢„ç•™ï¼‰
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# Cozeæ™ºèƒ½ä½“é…ç½®
COZE_API_URL=https://api.coze.cn
COZE_CLIENT_ID=your_coze_client_id
COZE_PRIVATE_KEY=your_coze_private_key
COZE_PRIVATE_KEY_FILE=/path/to/private_key.pem
COZE_PUBLIC_KEY_ID=your_coze_public_key_id
COZE_BOT_ID=your_coze_bot_id
COZE_WORKFLOW_ID=your_coze_workflow_id

# JWTå¯†é’¥
JWT_SECRET=your_jwt_secret_key_here
```

### å¿…éœ€é…ç½®é¡¹
- `ZHIPU_API_KEY`: æ™ºè°±AIçš„APIå¯†é’¥ï¼Œåœ¨[æ™ºè°±AIå¼€æ”¾å¹³å°](https://open.bigmodel.cn/)èŽ·å–
- `DB_PASSWORD`: æ•°æ®åº“å¯†ç 
- `REDIS_PASSWORD`: Rediså¯†ç ï¼ˆå¦‚æžœæœ‰è®¾ç½®å¯†ç ï¼‰
- `JWT_SECRET`: JWTç­¾åå¯†é’¥ï¼Œå»ºè®®ä½¿ç”¨é•¿éšæœºå­—ç¬¦ä¸²

### Cozeæ™ºèƒ½ä½“é…ç½®é¡¹
- `COZE_CLIENT_ID`: Cozeåº”ç”¨çš„Client IDï¼Œåœ¨[Cozeå¼€å‘è€…å¹³å°](https://www.coze.cn/)èŽ·å–
- `COZE_PRIVATE_KEY`: Cozeåº”ç”¨çš„ç§é’¥ï¼ˆPEMæ ¼å¼ï¼‰
- `COZE_PRIVATE_KEY_FILE`: ç§é’¥æ–‡ä»¶è·¯å¾„ï¼ˆä¸ŽCOZE_PRIVATE_KEYäºŒé€‰ä¸€ï¼‰
- `COZE_PUBLIC_KEY_ID`: Cozeåº”ç”¨çš„å…¬é’¥ID
- `COZE_BOT_ID`: è¦ä½¿ç”¨çš„Cozeæ™ºèƒ½ä½“ID
- `COZE_WORKFLOW_ID`: è¦ä½¿ç”¨çš„Cozeå·¥ä½œæµIDï¼ˆå¯é€‰ï¼Œç”¨äºŽå·¥ä½œæµæ¨¡å¼ï¼‰

## æµå¼AIå›žå¤ä½¿ç”¨æŒ‡å—

### åŠŸèƒ½ç‰¹æ€§
- âœ… **å®žæ—¶å“åº”**: æ”¯æŒServer-Sent Events (SSE)æµå¼è¾“å‡º
- âœ… **æ™ºè°±AIé›†æˆ**: å®Œæ•´æ”¯æŒæ™ºè°±AI GLMç³»åˆ—æ¨¡åž‹
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¿žæœºåˆ¶
- âœ… **ä½¿ç”¨è®°å½•**: è‡ªåŠ¨è®°å½•Tokenæ¶ˆè€—å’Œå“åº”æ—¶é—´
- âœ… **è¿žæŽ¥æŽ§åˆ¶**: æ”¯æŒå®¢æˆ·ç«¯ä¸»åŠ¨ä¸­æ–­ä¼ è¾“

### ä½¿ç”¨ç¤ºä¾‹
```go
// åˆ›å»ºAIæœåŠ¡å®žä¾‹
aiService := services.NewAiService()

// èŽ·å–AIæ¨¡åž‹
aiModel, _ := aiModelService.GetModelByName("glm-4-plus")

// å®šä¹‰æµå¼å›žè°ƒå‡½æ•°
streamCallback := func(chunk string, isEnd bool, err error) bool {
    if err != nil {
        log.Printf("é”™è¯¯: %v", err)
        return false // åœæ­¢æŽ¥æ”¶
    }
    
    if isEnd {
        fmt.Println("\næµå¼å›žå¤å®Œæˆ")
        return true
    }
    
    // å®žæ—¶è¾“å‡ºæ–‡æœ¬å—
    fmt.Print(chunk)
    return true // ç»§ç»­æŽ¥æ”¶
}

// è°ƒç”¨æµå¼AIå›žå¤
err := aiService.GenerateStreamResponse(
    aiModel, 
    "ä½ çš„é—®é¢˜", 
    history, 
    userId, 
    streamCallback
)
```

### è¿è¡Œç¤ºä¾‹
```bash
# è®¾ç½®çŽ¯å¢ƒå˜é‡
export ZHIPU_API_KEY="your_api_key_here"

# è¿è¡Œæµå¼å›žå¤ç¤ºä¾‹
cd chatbot-app/backend
go run examples/stream_example.go
```

### APIé›†æˆ
æµå¼AIå›žå¤å¯ä»¥è½»æ¾é›†æˆåˆ°Web APIä¸­ï¼š

```go
// åœ¨æŽ§åˆ¶å™¨ä¸­ä½¿ç”¨æµå¼å“åº”
func (controller *ChatController) StreamMessage(c *gin.Context) {
    // è®¾ç½®SSEå“åº”å¤´
    c.Header("Content-Type", "text/event-stream")
    c.Header("Cache-Control", "no-cache")
    c.Header("Connection", "keep-alive")
    
    // å®šä¹‰æµå¼å›žè°ƒ
    streamCallback := func(chunk string, isEnd bool, err error) bool {
        if err != nil {
            c.SSEvent("error", err.Error())
            return false
        }
        
        if isEnd {
            c.SSEvent("end", "")
            return true
        }
        
        c.SSEvent("data", chunk)
        c.Writer.Flush()
        return true
    }
    
    // è°ƒç”¨æµå¼AIæœåŠ¡
    err := controller.aiService.GenerateStreamResponse(
        selectedModel, prompt, history, userId, streamCallback
    )
    
    if err != nil {
        c.SSEvent("error", err.Error())
    }
}
```

### æ”¯æŒçš„AIæ¨¡åž‹
- **GLM-4**: æ™ºè°±AIé€šç”¨å¯¹è¯æ¨¡åž‹
- **GLM-4-Plus**: æ™ºè°±AIå¢žå¼ºç‰ˆå¯¹è¯æ¨¡åž‹
- **GLM-4-Air**: æ™ºè°±AIè½»é‡ç‰ˆæ¨¡åž‹
- **GLM-Z1**: æ™ºè°±AIæœ€æ–°æŽ¨ç†æ¨¡åž‹ï¼ˆæŽ¨èï¼‰
- **Cozeæ™ºèƒ½ä½“**: Cozeå¹³å°çš„æ™ºèƒ½ä½“å¯¹è¯æ¨¡å¼
- **Cozeå·¥ä½œæµ**: Cozeå¹³å°çš„å·¥ä½œæµæ¨¡å¼ï¼Œé€‚åˆå¤æ‚çš„å¤šæ­¥éª¤ä»»åŠ¡

### æ€§èƒ½ä¼˜åŒ–
- **è¿žæŽ¥æ± **: ä½¿ç”¨HTTPè¿žæŽ¥æ± å¤ç”¨è¿žæŽ¥
- **è¶…æ—¶æŽ§åˆ¶**: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
- **å†…å­˜ç®¡ç†**: æµå¼å¤„ç†å‡å°‘å†…å­˜å ç”¨
- **å¹¶å‘æ”¯æŒ**: æ”¯æŒå¤šä¸ªå¹¶å‘æµå¼è¯·æ±‚

### AIæ¨¡åž‹é…ç½®è¯´æ˜Ž
- **æ•°æ®åº“é©±åŠ¨**: ç³»ç»Ÿä»Žæ•°æ®åº“`ai_model`è¡¨è¯»å–AIæ¨¡åž‹é…ç½®
- **åŠ¨æ€åˆ‡æ¢**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢AIæ¨¡åž‹
- **API Keyç®¡ç†**: æ¨¡åž‹çš„API Keyä»ŽçŽ¯å¢ƒå˜é‡è¯»å–ï¼Œæé«˜å®‰å…¨æ€§
- **Base URLé…ç½®**: å¦‚æžœæ¨¡åž‹è¡¨ä¸­æ²¡æœ‰é…ç½®URLï¼Œåˆ™ä½¿ç”¨çŽ¯å¢ƒå˜é‡ä¸­çš„é»˜è®¤URL
- **å¤šæä¾›å•†æ”¯æŒ**: æ”¯æŒæ™ºè°±AIã€Cozeã€OpenAIç­‰å¤šç§AIæä¾›å•†ï¼ˆOpenAIå¾…å®žçŽ°ï¼‰

### Cozeæ™ºèƒ½ä½“ä½¿ç”¨ç¤ºä¾‹
```go
// åˆ›å»ºCozeæœåŠ¡å®žä¾‹
cozeService, err := services.NewCozeService()
if err != nil {
    log.Fatal("åˆ›å»ºCozeæœåŠ¡å¤±è´¥:", err)
}

// ä½¿ç”¨æµå¼å¯¹è¯
err = cozeService.GenerateStreamResponse(
    "è¯·å¸®æˆ‘åˆ†æžä¸€ä¸‹è¿™ä¸ªé—®é¢˜", 
    historyMessages, 
    userID, 
    func(chunk string, isEnd bool, err error) bool {
        if err != nil {
            log.Printf("é”™è¯¯: %v", err)
            return false
        }
        
        if isEnd {
            fmt.Println("\nå¯¹è¯å®Œæˆ")
            return true
        }
        
        fmt.Print(chunk) // å®žæ—¶è¾“å‡º
        return true
    },
)
```

### Cozeé…ç½®æ–‡ä»¶ç¤ºä¾‹
åˆ›å»º `config/coze_config.yaml` æ–‡ä»¶ï¼š
```yaml
coze:
  api_url: "https://api.coze.cn"
  client_id: "your_client_id"
  private_key: |
    -----BEGIN PRIVATE KEY-----
    your_private_key_content_here
    -----END PRIVATE KEY-----
  public_key_id: "your_public_key_id"
  bot_id: "your_bot_id"
  workflow_id: "your_workflow_id"  # å¯é€‰ï¼Œç”¨äºŽå·¥ä½œæµæ¨¡å¼
```

### Cozeå¿«é€Ÿå¼€å§‹

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**ï¼š
   ```bash
   cp config/coze_config.example.yaml config/coze_config.yaml
   ```

2. **å¡«å†™é…ç½®ä¿¡æ¯**ï¼š
   - è®¿é—® [Cozeå¼€å‘è€…å¹³å°](https://www.coze.cn/) èŽ·å–å‡­è¯
   - ç¼–è¾‘ `config/coze_config.yaml` å¡«å…¥å®žé™…å€¼

3. **æµ‹è¯•é…ç½®**ï¼š
   ```bash
   cd chatbot-app/backend
   go run examples/coze_example.go
   ```

4. **ä½¿ç”¨Cozeæ¨¡åž‹**ï¼š
   - å¯åŠ¨é¡¹ç›®åŽï¼Œåœ¨å‰ç«¯é€‰æ‹©"Cozeæ™ºèƒ½ä½“"æˆ–"Cozeå·¥ä½œæµ"æ¨¡åž‹
   - å¼€å§‹ä¸ŽCozeæ™ºèƒ½ä½“å¯¹è¯

è¯¦ç»†è®¾ç½®æŒ‡å—è¯·å‚è€ƒï¼š[docs/COZE_SETUP.md](docs/COZE_SETUP.md)

## è¿è¡Œè¯´æ˜Ž

### åŽç«¯å¯åŠ¨
```bash
cd chatbot-app/backend
go mod tidy
go run main.go
```

### æ—¥å¿—é…ç½®
æ—¥å¿—æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ `logs/app.log`ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®ï¼š
- æ—¥å¿—çº§åˆ«ï¼šdebug, info, warn, error
- æ—¥å¿—æ ¼å¼ï¼šjson, text
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼š100MB
- ä¿ç•™å¤©æ•°ï¼š30å¤©
- è‡ªåŠ¨åŽ‹ç¼©æ—§æ—¥å¿—

### APIæ–‡æ¡£
```bash
swag init -g chatbot-app/backend/main.go -o chatbot-app/backend/docs
```
å¯åŠ¨åŽè®¿é—®ï¼šhttp://localhost:8080/swagger/index.html

## å¼€å‘è§„èŒƒ

### æ—¥å¿—è®°å½•è§„èŒƒ
1. ä½¿ç”¨ç»“æž„åŒ–æ—¥å¿—ï¼ŒåŒ…å«ç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯
2. é”™è¯¯æ—¥å¿—å¿…é¡»åŒ…å«é”™è¯¯è¯¦æƒ…å’Œç›¸å…³å‚æ•°
3. ç”¨æˆ·æ“ä½œæ—¥å¿—åŒ…å«ç”¨æˆ·Idå’ŒIPåœ°å€
4. æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åˆ°æ—¥å¿—ä¸­

### é”™è¯¯å¤„ç†è§„èŒƒ
1. ç»Ÿä¸€ä½¿ç”¨utilsåŒ…ä¸­çš„å“åº”å‡½æ•°
2. è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
3. è¿”å›žç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

## APIæŽ¥å£

### èŠå¤©ç›¸å…³
- `POST /api/chat` - åˆ›å»ºèŠå¤©ä¼šè¯
- `GET /api/chat` - èŽ·å–èŠå¤©ä¼šè¯åˆ—è¡¨
- `GET /api/chat/{id}/message` - èŽ·å–èŠå¤©æ¶ˆæ¯
- `POST /api/chat/{id}/message` - å‘é€æ¶ˆæ¯ï¼ˆæµå¼å“åº”ï¼‰

#### æµå¼èŠå¤©APIè¯´æ˜Ž
`POST /api/chat/{id}/message` æŽ¥å£çŽ°åœ¨ä½¿ç”¨Server-Sent Events (SSE)æµå¼å“åº”ï¼Œæä¾›å®žæ—¶çš„AIå›žå¤ä½“éªŒã€‚

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:8080/api/chat/1/message \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_jwt_token" \
  -H "Accept: text/event-stream" \
  -d '{"content": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±", "model_id": 1}'
```

**å“åº”äº‹ä»¶ç±»åž‹**ï¼š
- `user_message` - ç”¨æˆ·æ¶ˆæ¯å·²ä¿å­˜
- `stream_start` - å¼€å§‹AIæµå¼å›žå¤
- `stream_chunk` - AIå›žå¤æ–‡æœ¬å—
- `stream_end` - AIå›žå¤å®Œæˆ
- `error` - é”™è¯¯ä¿¡æ¯

**å“åº”ç¤ºä¾‹**ï¼š
```
data: {"type":"user_message","message":{"id":1,"content":"ä½ å¥½"}}

data: {"type":"stream_start","model":"æ™ºè°±GLM-4-Plus"}

data: {"type":"stream_chunk","text":"ä½ å¥½ï¼"}

data: {"type":"stream_chunk","text":"æˆ‘æ˜¯æ™ºè°±AIåŠ©æ‰‹"}

data: {"type":"stream_end","message_id":2,"full_text":"ä½ å¥½ï¼æˆ‘æ˜¯æ™ºè°±AIåŠ©æ‰‹..."}
```

### å‰ç«¯æµå¼å“åº”é›†æˆ

å‰ç«¯å·²å®Œå…¨æ”¯æŒSSEæµå¼å“åº”ï¼Œæä¾›å®žæ—¶çš„ç”¨æˆ·ä½“éªŒï¼š

#### åŠŸèƒ½ç‰¹æ€§
- âœ… **å®žæ—¶æ¸²æŸ“**: æ–‡æœ¬å†…å®¹å®žæ—¶æ›´æ–°å’ŒMarkdownæ¸²æŸ“
- âœ… **æµå¼æŒ‡ç¤ºå™¨**: å¸¦åŠ¨ç”»çš„"æ­£åœ¨è¾“å…¥"æç¤º
- âœ… **è‡ªåŠ¨æ»šåŠ¨**: æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’Œé‡è¿žæœºåˆ¶
- âœ… **è¿žæŽ¥æŽ§åˆ¶**: æ”¯æŒä¸­æ–­æµå¼ä¼ è¾“

#### æŠ€æœ¯å®žçŽ°
- **Vue3 + Pinia**: å“åº”å¼çŠ¶æ€ç®¡ç†
- **Fetch Streams API**: åŽŸç”Ÿæµå¼æ•°æ®å¤„ç†
- **marked.js**: å®žæ—¶Markdownæ¸²æŸ“
- **Element Plus**: çŽ°ä»£åŒ–UIç»„ä»¶

#### ä½¿ç”¨æ–¹æ³•
```javascript
// åœ¨storeä¸­å‘é€æµå¼æ¶ˆæ¯
await chatStore.sendUserMessage(content, modelId)

// è‡ªåŠ¨å¤„ç†ä»¥ä¸‹SSEäº‹ä»¶:
// - user_message: ç”¨æˆ·æ¶ˆæ¯ä¿å­˜ç¡®è®¤
// - stream_start: å¼€å§‹AIå›žå¤
// - stream_chunk: å®žæ—¶æ–‡æœ¬å—
// - stream_end: å›žå¤å®Œæˆ
// - error: é”™è¯¯å¤„ç†
```

#### æµ‹è¯•å·¥å…·
é¡¹ç›®æä¾›äº†ç‹¬ç«‹çš„æµ‹è¯•é¡µé¢ï¼š
```bash
# è®¿é—®æµ‹è¯•é¡µé¢
open chatbot-app/frontend/src/test-stream.html
```

è¯¥æµ‹è¯•é¡µé¢å¯ä»¥ï¼š
- ç›´æŽ¥æµ‹è¯•SSEæµå¼å“åº”
- è°ƒè¯•ä¸åŒçš„æ¶ˆæ¯å†…å®¹
- æŸ¥çœ‹è¯¦ç»†çš„äº‹ä»¶æ—¥å¿—
- éªŒè¯JWT Tokenæœ‰æ•ˆæ€§

### AIæ¨¡åž‹ç›¸å…³
- `GET /api/ai/model` - èŽ·å–å¯ç”¨æ¨¡åž‹åˆ—è¡¨
- `POST /api/ai/model/set` - é€‰æ‹©AIæ¨¡åž‹
- `GET /api/ai/usage` - èŽ·å–æ¨¡åž‹ä½¿ç”¨è®°å½•

### ç”¨æˆ·ç›¸å…³
- `POST /api/user/login` - ç”¨æˆ·ç™»å½•
- `POST /api/user/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /api/user/info` - èŽ·å–ç”¨æˆ·ä¿¡æ¯
- `POST /api/user/logout` - ç”¨æˆ·ç™»å‡º

## ðŸŽ‰ å®Œæ•´æµå¼AIèŠå¤©ç³»ç»Ÿå·²å®Œæˆ

### å®Œæ•´åŠŸèƒ½é“¾è·¯
1. **å‰ç«¯å‘èµ·**: Vue3èŠå¤©ç•Œé¢å‘é€æ¶ˆæ¯
2. **åŽç«¯æŽ¥æ”¶**: Ginå¤„ç†HTTPè¯·æ±‚ï¼ŒéªŒè¯JWT
3. **AIè°ƒç”¨**: é€šè¿‡æ™ºè°±AIå®¢æˆ·ç«¯å‘èµ·æµå¼è¯·æ±‚
4. **æµå¼ä¼ è¾“**: Server-Sent Eventså®žæ—¶ä¼ è¾“æ–‡æœ¬å—
5. **å‰ç«¯æ¸²æŸ“**: å®žæ—¶Markdownæ¸²æŸ“å’ŒUIæ›´æ–°
6. **æ•°æ®å­˜å‚¨**: å®Œæ•´å¯¹è¯ä¿å­˜åˆ°MySQLæ•°æ®åº“

### æŠ€æœ¯æ ˆæ€»è§ˆ
```
å‰ç«¯: Vue3 + Pinia + Element Plus + marked.js
åŽç«¯: Go + Gin + GORM + JWT
æ•°æ®åº“: MySQL 8.0 + Redis
AIæœåŠ¡: æ™ºè°±AI GLMç³»åˆ—æ¨¡åž‹
é€šä¿¡: SSE (Server-Sent Events) + REST API
```

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å¯åŠ¨åŽç«¯æœåŠ¡
cd chatbot-app/backend
export ZHIPU_API_KEY="your_api_key_here"
go run main.go

# 2. å¯åŠ¨å‰ç«¯æœåŠ¡
cd chatbot-app/frontend
npm install
npm run dev

# 3. è®¿é—®åº”ç”¨
open http://localhost:3000
```

### ä½“éªŒæµå¼å¯¹è¯
1. æ³¨å†Œ/ç™»å½•è´¦æˆ·
2. åˆ›å»ºæ–°å¯¹è¯
3. å‘é€æ¶ˆæ¯å¹¶å®žæ—¶è§‚çœ‹AIå›žå¤
4. æ”¯æŒMarkdownæ ¼å¼ã€ä»£ç é«˜äº®ã€è¡¨æ ¼ç­‰
5. è‡ªåŠ¨ä¿å­˜å¯¹è¯åŽ†å²

## å¾…åŠžäº‹é¡¹
- [ ] å‰ç«¯æ¡†æž¶é€‰æ‹©å’Œæ­å»º
- [ ] ç”¨æˆ·ç•Œé¢è®¾è®¡
- [ ] AIæ¨¡åž‹é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™
- [ ] éƒ¨ç½²é…ç½®

## æœ€è¿‘ä¿®å¤

### SSEæ¶ˆæ¯æ¸²æŸ“é—®é¢˜ä¿®å¤ (2024-12)

**é—®é¢˜æè¿°ï¼š**
ä½¿ç”¨SSEåè®®è¯·æ±‚åŽç«¯å‘é€æ¶ˆæ¯æŽ¥å£æ—¶ï¼Œæ¶ˆæ¯å¯ä»¥æ­£å¸¸è¿”å›žï¼Œå‰ç«¯ä¹Ÿèƒ½æŽ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†æ˜¯æ²¡æœ‰æ­£ç¡®æ¸²æŸ“åˆ°é¡µé¢ã€‚

**ä¿®å¤å†…å®¹ï¼š**

1. **å“åº”å¼æ•°æ®å¤„ç†ä¼˜åŒ–**
   - ç§»é™¤äº†ä¸å¿…è¦çš„`reactive()`åŒ…è£…ï¼ŒPiniaå·²è‡ªåŠ¨å¤„ç†å“åº”å¼
   - ä¿®æ”¹æ¶ˆæ¯æ•°ç»„æ›´æ–°æ–¹å¼ï¼Œç¡®ä¿Vueèƒ½æ­£ç¡®æ£€æµ‹åˆ°å˜åŒ–
   - ä½¿ç”¨ç›´æŽ¥å¯¹è±¡æ›¿æ¢è€Œä¸æ˜¯å±žæ€§ä¿®æ”¹æ¥è§¦å‘å“åº”å¼æ›´æ–°

2. **SSEæ•°æ®è§£æžæ”¹è¿›**
   - ä¿®å¤äº†SSEæ•°æ®è§£æžé€»è¾‘ï¼Œæ­£ç¡®å¤„ç†Ginæ¡†æž¶çš„SSEæ ¼å¼
   - æ”¹è¿›äº†dataå­—æ®µçš„æå–æ–¹å¼ï¼š`data: jsondata` -> æ­£ç¡®trimå¤„ç†

3. **æ¶ˆæ¯Idç”Ÿæˆä¼˜åŒ–**
   - ä½¿ç”¨æ›´ç²¾ç¡®çš„Idç”Ÿæˆç®—æ³•ï¼Œé¿å…Idå†²çª
   - ä¸´æ—¶æ¶ˆæ¯Idæ ¼å¼ï¼š`temp_user_timestamp_randomstring` å’Œ `temp_bot_timestamp_randomstring`

4. **Vueç›‘å¬å™¨ä¼˜åŒ–**
   - æ·»åŠ äº†`flush: 'post'`é€‰é¡¹ç¡®ä¿DOMæ›´æ–°åŽæ‰§è¡Œ
   - å¢žåŠ äº†å¯¹storeä¸­messagesæ•°ç»„çš„ç›´æŽ¥ç›‘å¬
   - æ”¹è¿›äº†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºŽè°ƒè¯•

**æ ¸å¿ƒä¿®å¤ä»£ç ï¼š**

```javascript
// handleSSEEventä¸­çš„æ¶ˆæ¯æ›´æ–°æ–¹å¼
case 'stream_chunk':
  const currentMessage = this.messages[botMessageIndex]
  const updatedMessage = {
    ...currentMessage,
    content: currentMessage.content + eventData.text,
    isStreaming: true
  }
  // ç›´æŽ¥æ›¿æ¢æ¶ˆæ¯å¯¹è±¡æ¥è§¦å‘å“åº”å¼æ›´æ–°
  this.messages[botMessageIndex] = updatedMessage
  this.messageUpdateCount++
  break
```

**æµ‹è¯•éªŒè¯ï¼š**
- SSEæ¶ˆæ¯èƒ½å¤Ÿæ­£ç¡®è§£æžå’Œæ¸²æŸ“
- æµå¼æ–‡æœ¬èƒ½å¤Ÿå®žæ—¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
- æ¶ˆæ¯æ»šåŠ¨å’ŒUIæ›´æ–°æ­£å¸¸å·¥ä½œ

### æµå¼å“åº”é—ªå±ä¼˜åŒ– (2024-12)

**é—®é¢˜æè¿°ï¼š**
æ–‡æœ¬å¯ä»¥é€æ­¥å‡ºçŽ°ï¼Œä½†é¡µé¢åœ¨æ–‡æœ¬æ˜¾ç¤ºæ—¶ä¸€ç›´é—ªå±ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

**ä¼˜åŒ–å†…å®¹ï¼š**

1. **æ»šåŠ¨è¡Œä¸ºä¼˜åŒ–**
   - æ·»åŠ æ»šåŠ¨èŠ‚æµæœºåˆ¶ï¼Œé¿å…é¢‘ç¹æ»šåŠ¨æ“ä½œ
   - ä½¿ç”¨smoothæ»šåŠ¨æ›¿ä»£çž¬é—´è·³è½¬
   - è®¾ç½®50msçš„æ»šåŠ¨å»¶è¿Ÿå’Œ100msçš„é˜²æŠ–

2. **ç›‘å¬å™¨æ€§èƒ½ä¼˜åŒ–**
   - åˆå¹¶å¤šä¸ªé‡å¤çš„watchç›‘å¬å™¨
   - æ·»åŠ é˜²æŠ–æœºåˆ¶å‡å°‘è§¦å‘é¢‘çŽ‡
   - ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼Œå‡å°‘æŽ§åˆ¶å°æ€§èƒ½å½±å“

3. **Storeæ›´æ–°é¢‘çŽ‡æŽ§åˆ¶**
   - é™åˆ¶messageUpdateCountçš„æ›´æ–°é¢‘çŽ‡ï¼ˆæ¯100msæœ€å¤šä¸€æ¬¡ï¼‰
   - å‡å°‘ä¸å¿…è¦çš„å¼ºåˆ¶å“åº”å¼æ›´æ–°
   - ä¼˜åŒ–æ–‡æœ¬å—å¤„ç†çš„æ—¥å¿—è¾“å‡ºé¢‘çŽ‡

4. **CSSæ¸²æŸ“æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ `will-change`å±žæ€§ä¼˜åŒ–å…³é”®å…ƒç´ 
   - å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆ`transform: translateZ(0)`ï¼‰
   - ä½¿ç”¨CSS Containmentï¼ˆ`contain: layout style`ï¼‰
   - ä¼˜åŒ–åŠ¨ç”»å‚æ•°ï¼Œå‡å°‘è§†è§‰å¹²æ‰°

**ä¼˜åŒ–æ•ˆæžœï¼š**
- æ¶ˆé™¤äº†æ–‡æœ¬æµå¼æ˜¾ç¤ºæ—¶çš„é¡µé¢é—ªå±
- æå‡äº†æ»šåŠ¨çš„æµç•…åº¦
- å‡å°‘äº†CPUå’ŒGPUçš„æ¸²æŸ“è´Ÿæ‹…
- ä¿æŒäº†æµå¼æ–‡æœ¬çš„å®žæ—¶æ€§

**æ ¸å¿ƒä¼˜åŒ–ä»£ç ï¼š**

```javascript
// æ»šåŠ¨èŠ‚æµä¼˜åŒ–
let scrollTimer = null
const scrollToBottom = async () => {
  if (scrollTimer) clearTimeout(scrollTimer)
  scrollTimer = setTimeout(async () => {
    await nextTick()
    if (messagesContainer.value) {
      messagesContainer.value.scrollTo({
        top: messagesContainer.value.scrollHeight,
        behavior: 'smooth'
      })
    }
  }, 50)
}

// Storeæ›´æ–°é¢‘çŽ‡æŽ§åˆ¶
if (!this._lastUpdateTime || Date.now() - this._lastUpdateTime > 100) {
  this.messageUpdateCount++
  this._lastUpdateTime = Date.now()
}
```

```css
/* CSSæ€§èƒ½ä¼˜åŒ– */
.chat-messages {
  will-change: scroll-position;
  transform: translateZ(0);
}

.message-content {
  will-change: contents;
  contain: layout style;
}
```
